<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:vm="clr-namespace:OpenUtauMobile.ViewModels.Controls"
               xmlns:io="clr-namespace:System.IO;assembly=System.Runtime"
               xmlns:ustx="clr-namespace:OpenUtau.Core.Ustx;assembly=OpenUtau.Core"
                xmlns:converters="clr-namespace:OpenUtauMobile.ViewModels.Converters"
               Color="Transparent"
               x:Class="OpenUtauMobile.Views.Controls.ChooseSingerPopup">
    <toolkit:Popup.BindingContext>
        <vm:ChooseSingerPopupViewModel/>
    </toolkit:Popup.BindingContext>
    <toolkit:Popup.Resources>
        <converters:ByteDataImageSourceConverter x:Key="ByteDataImageSourceConverter" />
    </toolkit:Popup.Resources>

    <!-- 主体 -->
    <Border StrokeThickness="0"
            Background="{AppThemeBinding Dark=#444444, Light=White}"
            Padding="0"
            WidthRequest="400"
            StrokeShape="RoundRectangle 10">
        <Grid RowDefinitions="40, 300, 60">
            <!-- 标题栏 -->
            <Border BackgroundColor="#66CCFF" Padding="10,2,10,2">
                <Label x:Name="LabelTitle" Text="选择歌手" FontSize="20" HorizontalTextAlignment="Start" VerticalTextAlignment="Center"/>
            </Border>
            <!-- 输入框 -->
            <ScrollView Grid.Row="1" >
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Singers}">
                    <BindableLayout.EmptyView>
                        <Label Text="还没有歌手，请前往歌手管理页面添加！" />
                    </BindableLayout.EmptyView>
                    <BindableLayout.ItemTemplate>
                        <!-- 歌手卡片 -->
                        <DataTemplate x:DataType="ustx:USinger">
                            <Border Margin="2,2,10,0" HeightRequest="80" StrokeShape="RoundRectangle 25" StrokeThickness="0">
                                <Grid>
                                    <Grid ColumnDefinitions="15,80,*,50">
                                        <!-- 歌手类型颜色tag todo -->
                                        <BoxView Grid.Column="0" BackgroundColor="{DynamicResource Primary}" />
                                        <!-- 头像 -->
                                        <Border Grid.Column="1" StrokeShape="Ellipse" Margin="5" StrokeThickness="0">
                                            <Image Source="{Binding AvatarData, Converter={StaticResource ByteDataImageSourceConverter}}" />
                                        </Border>
                                        <!-- 名字和ID -->
                                        <Grid Grid.Column="2" RowDefinitions="40, 20" Margin="10,5,5,15">
                                            <Label Grid.Row="0" Text="{Binding LocalizedName}" FontSize="20" HorizontalTextAlignment="Start" VerticalTextAlignment="Center"/>
                                            <HorizontalStackLayout Grid.Row="1" >
                                                <Label Text="ID：" FontSize="15" HorizontalOptions="Start" VerticalTextAlignment="Center"  />
                                                <Label Text="{Binding Id}" FontSize="15" HorizontalOptions="Start" VerticalTextAlignment="Center" />
                                            </HorizontalStackLayout>
                                        </Grid>
                                    </Grid>
                                    <!-- 点击区域 -->
                                    <Button CornerRadius="0" x:Name="ButtonSinger" BackgroundColor="{DynamicResource SingerCardBackground}" Clicked="ButtonSinger_Clicked"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </ScrollView>
            <!-- 按钮栏 -->
            <HorizontalStackLayout Grid.Row="2" Margin="10" HorizontalOptions="End">
                <Button Text="取消" Clicked="OnCancelClicked" CornerRadius="25" WidthRequest="80" TextColor="{DynamicResource Primary}" BackgroundColor="Transparent"/>
            </HorizontalStackLayout>
        </Grid>
    </Border>
</toolkit:Popup>
